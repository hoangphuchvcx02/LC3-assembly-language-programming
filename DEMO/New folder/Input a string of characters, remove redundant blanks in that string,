 ; Input a string of characters, remove redundant blanks in that string, 
;then print it out on the screen. 
;Use IO registers KBSR, KBDR, DSR, DDR.

.ORIG x3000
LD R3,NEG_ENTER
LD R4,STORAGE

POLL_KEYBOARD 	LDI R1, KBSR
		BRzp POLL_KEYBOARD 
		LDI R0, KBDR

POLL_SCREEN 	LDI R1, DSR
		BRzp POLL_SCREEN
		
		
		STI R0, DDR
		
		AND R5,R5,#0
		ADD R5,R5,R0
		ADD R5,R5,R3
		BRz REMOVE_REDUNDANT_BLANKS
		
		STI R0, STORAGE
		ADD R4,R4,#1
		ST R4, STORAGE
		BR POLL_KEYBOARD
		
REMOVE_REDUNDANT_BLANKS LD R4,STORAGE_2
			LD R3,NEG_SPACE
			LD R2,SPACE
			
LOOP			AND R5,R5,#0
			LDI R6,STORAGE_2
			BRz DONE
			ADD R0,R6,#0
			ADD R6,R6,R3
			BRz BLANK

POLL_SCREEN_2 		LDI R1, DSR
			BRzp POLL_SCREEN_2
			STI R0, DDR
			ADD R4,R4,#1
			ST R4, STORAGE_2
			BR LOOP

BLANK			ADD R5,R5,#1
			ADD R4,R4,#1
			ST R4,STORAGE_2
			LDI R6,STORAGE_2
			ADD R0,R6,#0
			ADD R6,R6,R3
			BRz BLANK
			ADD R5,R5,#-1
			BRz ONE_BLANK
			BR LOOP

ONE_BLANK 		LDI R1, DSR
			BRzp ONE_BLANK
			AND R0,R0,#0
			ADD R0,R2,#0
			STI R0, DDR
			BR LOOP


DONE HALT			

KBSR .FILL xFE00
KBDR .FILL xFE02
DSR .FILL xFE04
DDR .FILL xFE06
NEG_ENTER .FILL #-10
NEG_SPACE .FILL #-32
SPACE .FILL #32
STORAGE .FILL x3100
STORAGE_2 .FILL x3100

.END
